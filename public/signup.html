<!DOCTYPE html>
<html>

<head>
    <title>MEDstruation Sign Up</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 500px;
            margin: 50px auto;
            padding: 20px;
            background-color: #FFCFCF;
        }

        h1 {
            text-align: center;
            color: white;
            font-size: 3em;
            margin-bottom: 10px;
        }

        h2 {
            text-align: center;
            color: white;
            font-weight: normal;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="date"],
        input[type="number"],
        input[type="file"] {
            width: 100%;
            padding: 12px;
            font-size: 14px;
            border: none;
            border-radius: 8px;
            box-sizing: border-box;
            background-color: white;
        }

        button {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            background-color: #ff5869;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
            font-weight: bold;
        }

        button:hover {
            background-color: #e54d5e;
        }

        #error {
            color: #d32f2f;
            background-color: #ffebee;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: none;
        }

        #success {
            color: #2e7d32;
            background-color: #e8f5e9;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: none;
        }

        .profile-pic-preview {
            max-width: 150px;
            max-height: 150px;
            margin-top: 10px;
            display: none;
            border-radius: 50%;
            border: 3px solid white;
        }

        .optional {
            color: #666;
            font-size: 12px;
            font-weight: normal;
        }

        p {
            text-align: center;
            color: #333;
        }

        a {
            color: #ff5869;
            text-decoration: none;
            font-weight: bold;
        }

        a:hover {
            text-decoration: underline;
        }
    </style>
</head>

<body>
    <h1>MEDstruation</h1>
    <h2>Signup Page</h2>

    <div id="error"></div>
    <div id="success"></div>

    <form id="signupForm">
        <div class="form-group">
            <label for="username">Username</label>
            <input type="text" id="username" placeholder="Enter Username" required minlength="3">
        </div>

        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" placeholder="Email" required>
        </div>

        <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" placeholder="Password (min 6 chars)" required minlength="6">
        </div>

        <div class="form-group">
            <label for="dateOfBirth">Date of Birth</label>
            <input type="date" id="dateOfBirth" required>
        </div>

        <div class="form-group">
            <label for="weight">Weight <span class="optional">(optional, in lbs)</span></label>
            <input type="number" id="weight" placeholder="Weight in pounds" min="0">
        </div>

        <div class="form-group">
            <label for="height">Height <span class="optional">(optional, in inches)</span></label>
            <input type="number" id="height" placeholder="Height in inches" min="0">
        </div>

        <div class="form-group">
            <label for="profilePicture">Profile Picture <span class="optional">(optional)</span></label>
            <input type="file" id="profilePicture" accept="image/*">
            <img id="preview" class="profile-pic-preview" alt="Profile preview">
        </div>

        <button type="submit">Sign Up</button>
    </form>

    <p><a href="/login">Already have an account? Login</a></p>

    <script>
        console.log('Signup script loaded');
        // Preview profile picture
        document.getElementById('profilePicture').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const preview = document.getElementById('preview');
                preview.src = event.target.result;
                preview.style.display = 'block';
            };
        reader.readAsDataURL(file);
        }
        });

        document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const errorDiv = document.getElementById('error');
            const successDiv = document.getElementById('success');
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';

            const username = document.getElementById('username').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const dateOfBirth = document.getElementById('dateOfBirth').value;
            const weight = document.getElementById('weight').value || null;
            const height = document.getElementById('height').value || null;
            // Transfer user data to session storage
            localStorage.setItem('currentUser', username);
            localStorage.setItem('currentEmail',email);
            localStorage.setItem('userPassword', password);
            localStorage.setItem('dateOfBirth', dateOfBirth);
            localStorage.setItem('currentHeight',height);
            localStorage.setItem('currentWeight', weight);
            // Get profile picture as base64
            let profilePicture = '';
            const fileInput = document.getElementById('profilePicture');
            if (fileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = async function (e) {
                    profilePicture = e.target.result;
                    await submitForm();
                };
                reader.readAsDataURL(fileInput.files[0]);
            } else {
                await submitForm();
            }

            
            async function submitForm() {
                // Skip fetch for now
                console.log('Skipping fetch, demo only');
                successDiv.textContent = 'Registration successful! Redirecting...';
                successDiv.style.display = 'block';
                setTimeout(() => window.location.href = 'index.html', 1500);
            }
        });
        

    </script>
</body>
</html>